<!--Add new question to form modal template --><div class="modal-header"><button type="button" class="close" ng-click="cancel()">&times;</button><h4 class="modal-title">{{ 'ADD_NEW_QUESTION' | translate }}</h4></div><div class="modal-body"><!-- Question details or add new question container --><div class="row"><div class="col-md-12"><div class="aside"><!-- Question information --><form id="questionForm" name="questionForm" class="form-horizontal" role="form" novalidate><div class="row"><div class="col-md-12"><div class="form-group"><label class="col-md-2 control-label" for="new-question-name" ng-if="!['SUBTITLE', 'FEEDBACK', 'TERMINUS'].includes(questionInfo.TYPE)">{{ 'QUESTION_NAME' | translate }}:</label><label class="col-md-2 control-label" for="new-question-name" ng-if="['SUBTITLE'].includes(questionInfo.TYPE)">{{ 'SUBTITLE' | translate }}:</label><label class="col-md-2 control-label" for="new-question-name" ng-if="['FEEDBACK', 'TERMINUS'].includes(questionInfo.TYPE)">{{ 'FEEDBACK' | translate }}:</label><div class="col-md-4"><input type="text" class="form-control" id="new-question-name" ng-model="questionInfo.NAME" maxlength="100"></div><label class="col-md-2 control-label" for="question-id-field">ID:</label><div class="col-md-4"><input type="text" class="form-control" id="question-id-field" ng-model="questionInfo.ID" maxlength="100" ng-disabled="disabledID"></div></div><div class="form-group"><label class="col-md-2 control-label" for="new-question-text" ng-if="!['SUBTITLE'].includes(questionInfo.TYPE)">{{ 'QUESTION_TEXT' | translate }}:</label><label class="col-md-2 control-label" for="new-question-text" ng-if="['SUBTITLE'].includes(questionInfo.TYPE)">{{ 'SUBTITLE_TEXT' | translate }}:</label><div class="col-md-10"><div text-angular="text-angular" name="questiontext" id="new-question-text" ng-model="questionInfo.QUESTIONTEXT" ta-disabled="disabled"></div></div></div><div class="form-group" ng-if="!['FEEDBACK', 'TERMINUS'].includes(questionInfo.TYPE)"><label class="col-md-2 control-label" for="additional-text">{{ 'INSTRUCTION_TEXT' | translate }}:</label><div class="col-md-10"><div text-angular="text-angular" name="additionaltext" id="additional-text" ng-model="questionInfo.ADDITIONALTEXT" ta-disabled="disabled"></div></div></div><div class="form-group"><label class="col-md-2 control-label" for="new-question-description">{{ 'DESCRIPTION' | translate }}:</label><div class="col-md-10"><textarea class="form-control" id="new-question-description" ng-model="questionInfo.DESCRIPTION" maxlength="250"></textarea></div></div><div class="form-group"><label class="col-md-2 control-label" for="new-question-approval">{{ 'APPROVER' | translate }}:</label><div class="col-md-4"><input type="text" class="form-control" id="new-question-approval" ng-model="questionInfo.USER_APPROVED" maxlength="100" ng-disabled="disabledApproval"></div></div><hr><div class="form-group" ng-if="questionID" ng-repeat="(codeKey, code) in questionInfo.CODES"><label class="col-md-2 control-label" for="question-code-{{codeKey}}-system">{{ 'CODE_CLASSIFICATION' | translate }}:</label><div class="col-md-2"><select class="form-control detail-input" id="question-code-{{codeKey}}-system" ng-model="code.SYSTEM_ID" ng-disabled="code.ID !== undefined" convert-to-number><option ng-repeat="system in codeSystems" value="{{system.ID}}">{{system.NAME}}</option></select></div><label class="col-md-2 control-label" for="question-code-{{codeKey}}-value">{{ 'CODE' | translate }}:</label><div class="col-md-2"><input type="text" class="form-control" id="question-code-{{codeKey}}-value" ng-model="code.VALUE" ng-readonly="code.ID !== undefined" list="system-{{code.SYSTEM_ID}}-codes"></div><div class="col-md-2"><button type="button" class="btn btn-sm btn-default" ng-click="removeQuestionCode(code.ID, codeKey)">{{ 'REMOVE' | translate }}</button></div></div><div class="form-group"><div class="col-md-2 col-md-offset-2"><button type="button" class="btn btn-sm btn-blue" ng-click="addQuestionCode()">{{ 'ADD_CODE' | translate }}</button></div></div><hr><!-- Question type --><div class="form-group"><label class="col-md-2 control-label">{{ 'QUESTION_TYPE' | translate }}:</label><div class="col-md-10 radio"><label class="radio-inline" ng-repeat="type in questionTypeOptions track by $index"><input id="{{ type.type }}" type="radio" name="questionTypes" ng-model="questionInfo.TYPE" value="{{ type.type }}" required>{{ type.text }}</label><p ng-if="questionForm.questionTypes.$invalid" class="bg-danger form-validation-error">{{ 'QUESTION_TYPE_VALIDATION_ERROR' | translate }}</p></div></div></div></div></form></div></div></div><!-- Container for answers --><div class="aside"><div class="row"><div class="col-md-12"><div class="row operations-row"><div class="col-md-6"><h3 class="headerWithLoading" ng-if="!['SUBTITLE'].includes(questionInfo.TYPE)">{{ 'ANSWER_OPTIONS' | translate }}</h3><i class="glyphicon glyphicon-repeat gly-spin" ng-show="isLoading.answers"></i> <i class="glyphicon glyphicon-ok successTick" ng-show="isLoading.answersSuccess"></i></div></div><!-- Question type changed, not yet saved --><div class="row" ng-if="questionID > 0 && (questionInfo.TYPE != oldQuestionInfo.TYPE && !((questionInfo.TYPE === 'SELECT' || questionInfo.TYPE === 'CHECK') && (oldQuestionInfo.TYPE === 'SELECT' || oldQuestionInfo.TYPE === 'CHECK' )))"><div class="col-md-12"><p>{{ 'SAVING_INSTRUCTIONS' | translate }}</p></div></div><!-- Number value answer --><div class="row" ng-if="questionID > 0 && (questionInfo.TYPE === 'NUMBER' && oldQuestionInfo.TYPE == questionInfo.TYPE)"><div class="col-md-12"><p class="saving-text" ng-class="savingInfo.value">{{ savingInfo.text }}</p><div class="form-group"><label class="col-md-2 col-xs-12 control-label" for="minimum">{{ 'MINIMUM_VALUE' | translate }}:</label><div class="col-sm-2 col-xs-12"><input type="text" class="form-control" id="minimum" maxlength="100" ng-model="answers[0].MIN"></div><label class="col-md-2 col-xs-12 control-label" for="maximum">{{ 'MAXIMUM_VALUE' | translate }}:</label><div class="col-sm-2 col-xs-12"><input type="text" class="form-control" id="maximum" maxlength="100" ng-model="answers[0].MAX"></div><label class="col-md-2 col-xs-12 control-label" for="unit">{{ 'ANSWER_IN_UNIT' | translate }}:</label><div class="col-sm-2 col-xs-12"><select ng-model="answers[0].UNIT_ID" id="unit" ng-options="obj.value as obj.text for obj in Units" class="form-control"><option value="">-{{ 'CHOOSE' | translate }}-</option></select></div></div></div></div><!-- Multichoice answers --><div ng-if="questionID > 0 && ((questionInfo.TYPE === 'SELECT' || questionInfo.TYPE === 'CHECK') && (oldQuestionInfo.TYPE === 'SELECT' || oldQuestionInfo.TYPE === 'CHECK' ))"><div class="row operations-row"><!-- Add new choice --><div class="col-md-5"><div class="input-group"><input type="text" class="form-control" ng-model="newAnswerText" maxlength="250" placeholder="{{ 'NEW_ANSWER_ENTRY' | translate }}"> <span class="input-group-btn"><button type="button" class="btn btn-default btn-blue" ng-click="addAnswer(newAnswerText)">{{ 'ADD' | translate }}</button></span></div></div><!-- Remove & move up/down buttons --><div class="col-md-7"><button type="button" class="btn btn-default btn-blue" ng-click="removeAnswer(selectedRow)">{{ 'REMOVE' | translate }}</button> <button type="button" class="btn btn-default btn-white" ng-click="moveUp(selectedRow)" ng-disabled="isLoading.answers" tooltip="{{ tooltipMoveUp }}"><i class="glyphicon glyphicon-arrow-up"></i></button> <button type="button" class="btn btn-default btn-white" ng-click="moveDown(selectedRow)" ng-disabled="isLoading.answers" tooltip="{{ tooltipMoveDown }}"><i class="glyphicon glyphicon-arrow-down"></i></button><p class="saving-text" ng-class="savingInfo.value">{{ savingInfo.text }}</p></div></div><div ng-repeat="(answerKey, answer) in answers track by $index"><div class="form-group"><div class="col-md-12"><div class="input-group input-group-sm"><span class="input-group-addon"><input type="radio" name="selectedChoice" ng-model="$parent.selectedRow" value="{{ answer.ID }}"> </span><span class="input-group-addon">ID:{{ answer.ID }} </span><span class="input-group-addon">{{ 'ANSWER' | translate }}: </span><input type="text" class="form-control" ng-model="answer.ANSWER_TEXT" placeholder="{{ placeholderText }}" maxlength="250"> <span class="input-group-addon">{{ 'ANSWER_VALUE' | translate }}: </span><input type="text" class="form-control" ng-model="answer.ANSWER_VALUE" maxlength="250"></div></div></div><div class="form-group" ng-repeat="(codeKey, code) in answer.CODES"><label class="col-md-2 control-label" for="answer-{{answerKey}}-code-{{codeKey}}-system">{{ 'CODE_CLASSIFICATION' | translate }}:</label><div class="col-md-2"><select class="form-control detail-input" id="answer-{{answerKey}}-code-{{codeKey}}-system" ng-model="code.SYSTEM_ID" ng-disabled="code.ID !== undefined" convert-to-number><option ng-repeat="system in codeSystems" value="{{system.ID}}">{{system.NAME}}</option></select></div><label class="col-md-2 control-label" for="answer-{{answerKey}}-code-{{codeKey}}-value">{{ 'CODE' | translate }}:</label><div class="col-md-2"><input type="text" class="form-control" id="answer-{{answerKey}}-code-{{codeKey}}-value" ng-model="code.VALUE" ng-readonly="code.ID !== undefined" list="system-{{code.SYSTEM_ID}}-codes"></div><div class="col-md-2"><button type="button" class="btn btn-sm btn-default" ng-click="removeAnswerCode(answer.ID, code.ID, codeKey)">{{ 'REMOVE' | translate }}</button></div><div class="col-md-2" ng-if="codeKey === answer.CODES.length - 1"><button type="button" class="btn btn-sm btn-blue" ng-click="addAnswerCode(answer.ID)">{{ 'ADD_CODE' | translate }}</button></div></div><div class="form-group" ng-if="answer.CODES.length === 0"><div class="col-md-2 col-md-offset-10"><button type="button" class="btn btn-sm btn-blue" ng-click="addAnswerCode(answer.ID)">{{ 'ADD_CODE' | translate }}</button></div></div></div></div><!-- New question, cannot enter choices before saving --><div class="col-md-12" ng-if="!questionID"><p>{{ 'SAVE_BEFORE_OPTIONS' | translate }}</p></div><!-- QUESTION PREVIEW --><h4 class="operations-row">{{ 'PREVIEW' | translate }}</h4><!-- Yes/no answers --><div class="form-group" ng-if="questionID > 0 && (questionInfo.TYPE === 'YESNO' && oldQuestionInfo.TYPE == questionInfo.TYPE)"><label class="col-sm-3 control-label" ng-bind-html="questionInfo.QUESTIONTEXT"></label><div class="radio"><label class="radio-inline"><input type="radio">{{ 'YES' | translate }}</label><label class="radio-inline"><input type="radio">{{ 'NO' | translate }}</label></div></div><!-- Number/text value --><div class="form-group" ng-if="questionID > 0 && ((questionInfo.TYPE === 'NUMBER' || questionInfo.TYPE === 'TEXT') && oldQuestionInfo.TYPE == questionInfo.TYPE)"><label class="col-sm-3 control-label" ng-bind-html="questionInfo.QUESTIONTEXT"></label><div class="col-sm-3"><input type="text" class="form-control" placeholder="{{ 'ANSWERTEXT' | translate }}"></div></div><!-- Date value --><div class="form-group" ng-if="questionID > 0 && ((questionInfo.TYPE === 'DATE') && oldQuestionInfo.TYPE == questionInfo.TYPE)"><label class="col-sm-3 control-label" ng-bind-html="questionInfo.QUESTIONTEXT"></label><div class="col-sm-3"><div class="input-group"><input ng-model="NotInUse" type="text" class="form-control detail-input" placeholder="{{ 'ANSWERDATE' | translate }}" datepicker-popup="dd.MM.yyyy" datepicker-options="calendarOptions" is-open="calendar1Open" starting-day="1" close-text="Sulje" current-text="Tänään" clear-text="Tyhjennä"> <span class="input-group-btn"><button type="button" class="btn btn-default" id="openStartDate" ng-click="openStartDateCalendar($event)"><i class="glyphicon glyphicon-calendar"></i></button></span></div></div></div><!-- Text value --><div class="form-group" ng-if="questionID > 0 && (questionInfo.TYPE === 'TEXTAREA' && oldQuestionInfo.TYPE == questionInfo.TYPE)"><label class="col-sm-3 control-label" ng-bind-html="questionInfo.QUESTIONTEXT"></label><div class="col-sm-5"><textarea class="form-control" placeholder="{{ 'ANSWERTEXT' | translate }}"></textarea></div></div><!-- Subtitle & Feedback & Terminus --><div class="form-group" ng-if="questionID > 0 && ['SUBTITLE', 'FEEDBACK', 'TERMINUS'].includes(questionInfo.TYPE))"><div class="col-sm-12"><h2 style="margin-top:10px">{{questionInfo.NAME}}</h2></div><div class="col-sm-12" ng-bind-html="questionInfo.QUESTIONTEXT"></div></div><!-- Multichoice --><div ng-if="questionID > 0 && (questionInfo.TYPE === 'SELECT' && (oldQuestionInfo.TYPE === 'SELECT' || oldQuestionInfo.TYPE === 'CHECK' ))"><div class="row"><label class="col-md-12" ng-bind-html="questionInfo.QUESTIONTEXT"></label></div><div class="col-md-10 radio" ng-repeat="answer in answers track by $index"><label><input type="radio">{{ answer.ANSWER_TEXT }}</label></div></div><div ng-if="questionID > 0 && (questionInfo.TYPE === 'CHECK' && (oldQuestionInfo.TYPE === 'SELECT' || oldQuestionInfo.TYPE === 'CHECK' ))"><div class="row"><label class="col-md-12" ng-bind-html="questionInfo.QUESTIONTEXT"></label></div><div class="col-md-10 checkbox" ng-repeat="answer in answers track by $index"><label><input type="checkbox">{{ answer.ANSWER_TEXT }}</label></div></div></div></div></div></div><div class="modal-footer"><button ng-disabled="questionForm.$invalid" type="submit" class="btn btn-default btn-blue" id="save-question-button" ng-click="saveQuestion()">{{ 'SAVE' | translate }}</button> <button type="button" class="btn btn-default btn-blue" id="link-to-form-button" ng-click="ok()" ng-if="questionID">{{ 'LINK_TO_FORM' | translate }}</button> <button type="button" class="btn btn-default btn-white" id="cancel-link-button" ng-click="cancel()" ng-if="questionID">{{ 'CANCEL_LINK' | translate }}</button> <button type="button" class="btn btn-default btn-white" id="cancel-question-button" ng-click="cancel()" ng-if="!questionID">{{ 'CANCEL' | translate }}</button></div><datalist ng-repeat="(systemId, codes) in systemCodes" id="system-{{systemId}}-codes"><option ng-repeat="code in codes" value="{{code.VALUE}}"></option></datalist>