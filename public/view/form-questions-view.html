<div class="box"><div class="box-inner"><div class="box-header well"><h2><i class="glyphicon glyphicon-repeat gly-spin" ng-show="loading.formQuestions"></i><i class="glyphicon glyphicon-ok" ng-show="!loading.formQuestions"></i>&nbsp;{{ 'FORM_QUESTIONS' | translate }}</h2></div><div class="box-content"><div class="row settings-row"><div class="col-sm-12"><!-- Buttons for expanding/hiding all questions --><div class="btn-group btn-group-sm"><button type="button" class="btn btn-default" id="expand-all-questions" ng-click="expandAll()">{{ 'EXPAND_ALL' | translate }}</button> <button type="button" class="btn btn-default" id="collapse-all-questions" ng-click="collapseAll()">{{ 'COLLAPSE_ALL' | translate }}</button></div>&nbsp;<!-- Button for moving questions up/down --> <button ng-hide="readonlymode" class="btn btn-default btn-sm" ng-click="toggleSortControl()">{{ 'REORDER_QUESTIONS' | translate }}</button><!-- Button for adding new question --><div class="btn-group btn-group-sm pull-right" dropdown is-open="addQuestionDropdown.isopen"><button ng-hide="readonlymode" type="button" class="btn btn-default btn-blue dropdown-toggle" id="add-question-form" ng-disabled="loading.questions" dropdown-toggle>{{ 'ADD_QUESTION' | translate }}&nbsp;<span class="caret"></span></button><ul class="dropdown-menu" role="menu"><li><a ng-click="openNewQuestionModal()" id="new-question-form">{{ 'NEW_QUESTION' | translate }}</a></li><li><a ng-click="openLinkQuestionModal()" id="link-question-form">{{ 'SEARCH_QUESTIONS' | translate }}</a></li></ul></div></div></div><div class="row"><div class="col-xs-12 col-accordion"><!-- List of questions is shown here. When question name is clicked, question details will expand downward --><div ng-repeat="(questionIndex, question) in questions track by question.ID" ng-class='{"form-error": hasInvalidLogics(question) || hasIllegalDisplayRules(question)}'><div class="panel panel-default question-panel"><div class="panel-heading question-heading"><div ng-hide="!showSortControls" class="btn-group btn-group-sm"><button type="button" class="btn btn-default" ng-click="moveQuestionUp(questionIndex)" ng-disabled="questionIndex === 0"><i class="glyphicon glyphicon-arrow-up"></i></button> <button type="button" class="btn btn-default" ng-click="moveQuestionDown(questionIndex)" ng-disabled="questionIndex === questions.length - 1"><i class="glyphicon glyphicon-arrow-down"></i></button></div><a ng-click="showQuestionAndDisplayLogic(question)"><span class="glyphicon glyphicon-triangle-right accordion-title" ng-hide="question.expanded" style="margin-left:30px"></span> <span class="glyphicon glyphicon-triangle-bottom accordion-title" ng-show="question.expanded" style="margin-left:30px"></span> <span class="accordion-title"><span id="accordion-question-name">{{ question.POSITION }}. {{ question.NAME }} [ID:{{question.ID}}]</span> </span></a><span ng-show="question.GROUP_QUESTION">{{ 'GROUP' | translate }}: {{ getQuestionGroupName(question) }}</span> <span class="text-danger" ng-show="hasInvalidLogics(question)">{{ 'INVALID_DISPLAY_LOGIC' | translate}}</span> <span class="text-danger" ng-show="hasIllegalDisplayRules(question)">{{ 'ILLEGAL_DISPLAY_LOGIC_COMBINATION' | translate}}</span></div><div class="panel-body question-body" collapse="!question.expanded"><form class="form-horizontal"><div class="form-group"><h4>{{ 'QUESTION_DISPLAY_LOGIC' | translate }}</h4></div><div class="form-group" ng-show="(question.DISPLAYRULES || []).length > 0"><table class="table table-hover table-condensed table-striped"><thead><tr><th>{{ 'OPERATOR' | translate }}</th><th>{{ 'QUESTION' | translate }}</th><th>{{ 'DISPLAY_LOGIC_DISPLAY_IF' | translate }}</th><th></th><th class="remove"></th></tr></thead><tbody><tr ng-repeat="logic in question.DISPLAYRULES track by $index" class="showCell" ng-class='{"text-danger": logic.invalid}'><td><select ng-hide="readonlymode" ng-model="logic.OPERATOR" ng-change="saveDisplayRuleOperator(logic.OPERATOR,logic.ID,question)"><option value="AND">{{ 'AND' | translate }}</option><option value="OR">{{ 'OR' | translate }}</option></select><div ng-show="readonlymode && $index !== 0">{{ logic.OPERATOR }}</div></td><td>{{logic.POSITION}}. {{logic.NAME}}</td><td><div ng-show="logic.TYPE=='YESNO'">{{ 'DISPLAY_LOGIC_YESNO' | translate }}: <b>{{logic.VALUE}}</b>.</div><div ng-show="logic.TYPE=='NUMBER'">{{ 'DISPLAY_LOGIC_NUMERIC' | translate }} <b>{{logic.LOGIC}} {{logic.VALUE}}</b>.</div><div ng-show="logic.TYPE=='TEXT'">{{ 'DISPLAY_LOGIC_TEXT' | translate }} <b>{{logic.LOGIC}} "{{logic.VALUE}}"</b>.</div><div ng-show="logic.TYPE=='TEXTAREA'">{{ 'DISPLAY_LOGIC_TEXT' | translate }} <b>{{logic.LOGIC}} "{{logic.VALUE}}"</b>.</div><div ng-show="logic.TYPE=='SELECT'">{{ 'DISPLAY_LOGIC_SELECTONE' | translate }} FI: <b>"{{logic.ANSWER_TEXT}}"</b></div><div ng-show="logic.TYPE=='CHECK'">{{ 'DISPLAY_LOGIC_SELECTMANY' | translate }} FI: <b>"{{logic.ANSWER_TEXT}}"</b></div></td><td><div ng-show="logic.invalid"><strong>{{ 'INVALID_DISPLAY_LOGIC' | translate}}</strong></div></td><td><a ng-hide="readonlymode" class="glyphicon glyphicon-remove hiddenCell remove-button" ng-click="deleteRule(logic.ID, question)" tooltip="{{ 'REMOVE_DISPLAY_LOGIC' | translate }}"></a></td></tr></tbody></table></div><div class="form-group" ng-show="(question.DISPLAYRULES || []).length === 0">{{ 'NO_DISPLAY_LOGIC' | translate }}</div><div class="form-group"><button ng-hide="readonlymode" type="button" class="btn btn-primary btn-sm pull-right" id="add-display-logic" ng-click="modifyQuestionDisplayLogic(question)">{{ 'ADD_NEW_DISPLAY_LOGIC' | translate }}</button></div><div class="form-group"><div class="col-sm-12"><h4>{{ 'QUESTION_INFO' | translate }}</h4></div></div><div class="form-group" ng-if="!['SUBTITLE', 'FEEDBACK', 'TERMINUS'].includes(question.TYPE)"><div class="col-sm-12"><label class="checkbox-inline"><input type="checkbox" ng-click="setOptional(question)" ng-checked="question.OPTIONAL==1"> {{ 'OPTIONAL' | translate }}</label></div><div class="col-sm-12"><label class="checkbox-inline"><input type="checkbox" ng-click="setReadOnly(question)" ng-checked="question.READ_ONLY==1"> {{ 'READ_ONLY' | translate }}</label></div></div><div class="form-group" ng-if="question.TYPE !== 'GROUP' && !readonlymode"><label class="col-sm-2 control-label" for="question-{{question.ID}}">{{ 'GROUP' | translate }}:</label><div class="col-sm-2"><select class="form-control detail-input" id="question-{{question.ID}}" ng-model="question.GROUP_QUESTION" ng-change="setQuestionGroup(question)" convert-to-number><option value=""></option><option ng-repeat="group in groupQuestions" value="{{group.ID}}">{{group.NAME}}</option></select></div></div><div class="form-group"><label class="col-sm-2 control-label" for="question-name" ng-if="!['SUBTITLE', 'FEEDBACK', 'TERMINUS'].includes(question.TYPE)">{{ 'QUESTION_NAME' | translate }}:</label><label class="col-sm-2 control-label" for="question-name" ng-if="['SUBTITLE'].includes(question.TYPE)">{{ 'SUBTITLE' | translate }}:</label><label class="col-sm-2 control-label" for="question-name" ng-if="['FEEDBACK', 'TERMINUS'].includes(question.TYPE)">{{ 'FEEDBACK' | translate }}:</label><div class="col-sm-4"><input type="text" class="form-control" ng-disabled="!question.enabled" id="question-name" ng-model="question.NAME" required maxlength="100"></div><label class="col-sm-2 control-label" for="question-id">ID:</label><div class="col-sm-4"><input type="text" class="form-control" ng-disabled="!question.enabled" id="question-id" ng-model="question.ID" maxlength="100"></div></div><div class="form-group"><label class="col-sm-2 control-label" for="question-text" ng-if="!['SUBTITLE', 'FEEDBACK', 'TERMINUS'].includes(question.TYPE)">{{ 'QUESTION_TEXT' | translate }}:</label><label class="col-sm-2 control-label" for="question-text" ng-if="['SUBTITLE'].includes(question.TYPE)">{{ 'SUBTITLE_TEXT' | translate }}:</label><label class="col-sm-2 control-label" for="question-text" ng-if="['FEEDBACK', 'TERMINUS'].includes(question.TYPE)">{{ 'FEEDBACK_TEXT' | translate }}:</label><div class="col-sm-10"><div ng-bind-html="question.QUESTIONTEXT" id="question-text"></div></div></div><div class="form-group" ng-if="!['FEEDBACK', 'TERMINUS'].includes(question.TYPE)"><label class="col-sm-2 control-label" for="additional-text">{{ 'INSTRUCTION_TEXT' | translate }}:</label><div class="col-sm-10"><div ng-bind-html="question.ADDITIONALTEXT" id="additional-text"></div></div></div><div class="form-group"><label class="col-sm-2 control-label" for="question-description">{{ 'DESCRIPTION' | translate }}:</label><div class="col-sm-10"><textarea class="form-control" id="question-description" rows="4" ng-model="question.DESCRIPTION" ng-disabled="!question.enabled" required></textarea></div></div><div class="form-group"><label class="col-sm-2 control-label" for="question-approver">{{ 'APPROVER' | translate }}:</label><div class="col-sm-4"><input type="text" class="form-control" ng-disabled="!question.enabled" id="question-approver" ng-model="question.USER_APPROVED" required maxlength="100"></div></div><div class="form-group"><label class="col-md-2 control-label">{{ 'QUESTION_TYPE' | translate }}:</label><div class="col-md-12 radio"><label class="radio-inline" ng-repeat="type in questionTypes track by $index"><input type="radio" ng-model="$parent.question.TYPE" value="{{ type.type }}" id="{{ type.type }}" ng-disabled="!question.enabled"> {{ type.text }}</label></div></div><div class="form-group" ng-if="question.TYPE=='CHECK' || question.TYPE=='SELECT'"><label class="col-md-2 control-label">{{ 'ADD_NONE_OF_THE_ABOVE' | translate }}:</label><div class="col-md-10 radio" style="margin-top:15px"><input type="checkbox" ng-model="question.NONE_ANSWER" ng-true-value="'Y'" ng-false-value="''"> {{ 'ADD_NONE_OF_THE_ABOVE2' | translate }}</div></div><div class="row operations-row"><div class="col-md-6"><h4 ng-if="!['SUBTITLE', 'FEEDBACK', 'TERMINUS'].includes(question.TYPE)">{{ 'ANSWER_OPTIONS' | translate }}</h4></div></div><!-- Yes/no answers --><div class="form-group" ng-if="question.TYPE == 'YESNO'"><label class="col-md-6" ng-bind-html="question.QUESTIONTEXT"></label><div class="radio"><label class="radio-inline"><input type="radio" disabled="disabled">{{ 'YES' | translate }}</label><label class="radio-inline"><input type="radio" disabled="disabled">{{ 'NO' | translate }}</label></div></div><!-- Number/text value --><div class="form-group" ng-if="question.TYPE == 'NUMBER' || question.TYPE == 'TEXT' "><label class="col-md-6" ng-bind-html="question.QUESTIONTEXT"></label><div class="col-md-3"><input type="text" class="form-control" placeholder="{{ 'ANSWERTEXT' | translate }}" disabled="disabled"></div></div><!-- Date value --><div class="form-group" ng-if="question.TYPE == 'DATE'"><label class="col-md-3 control-label" ng-bind-html="question.QUESTIONTEXT"></label><div class="col-md-3"><div class="input-group"><input ng-model="NotInUse" type="text" class="form-control detail-input" placeholder="{{ 'ANSWERDATE' | translate }}" datepicker-popup="dd.MM.yyyy" datepicker-options="calendarOptions" is-open="calendar1Open" starting-day="1" close-text="Sulje" current-text="Tänään" clear-text="Tyhjennä"> <span class="input-group-btn"><button type="button" class="btn btn-default" id="openStartDate" ng-click="openStartDateCalendar($event)"><i class="glyphicon glyphicon-calendar"></i></button></span></div></div></div><!-- Text value --><div class="form-group" ng-if="question.TYPE == 'TEXTAREA'"><label class="col-md-6" ng-bind-html="question.QUESTIONTEXT"></label><div class="col-md-5"><textarea class="form-control" placeholder="{{ 'ANSWERTEXT' | translate }}" disabled="disabled"></textarea></div></div><!-- Multichoice --><div ng-if="question.TYPE == 'SELECT'"><div class="row"><label class="col-md-12" ng-bind-html="question.QUESTIONTEXT"></label></div><div class="col-md-12 radio" ng-repeat="answer in question.ANSWERS track by $index"><label><input type="radio" disabled="disabled">{{ answer.ANSWER_TEXT }} <i>[ID:{{answer.ID}}]</i> <i>[{{'ANSWER_VALUE' | translate}}:{{answer.ANSWER_VALUE}}]</i></label></div></div><div ng-if="question.TYPE == 'CHECK'"><div class="row"><label class="col-md-12" ng-bind-html="question.QUESTIONTEXT"></label></div><div class="col-md-12 checkbox" ng-repeat="answer in question.ANSWERS track by $index"><label><input type="checkbox" disabled="disabled">{{ answer.ANSWER_TEXT }} <i>[ID:{{answer.ID}}]</i> <i>[{{'ANSWER_VALUE' | translate}}:{{answer.ANSWER_VALUE}}]</i></label></div></div><button ng-hide="readonlymode" type="button" class="btn btn-danger btn-sm pull-right" id="remove-question-button" ng-click="removeQuestion(question)" style="margin-left:20px">{{ 'REMOVE_FROM_FORM' | translate }}</button>&nbsp;&nbsp;&nbsp; <button type="button" class="btn btn-primary btn-sm pull-right" id="edit-question-button" ui-sref="secured.questionDetails({ questionid: '{{question.ID}}' })">{{ 'EDIT_QUESTION' | translate }}</button></form></div></div></div></div></div></div></div></div>